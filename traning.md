# Corda トレーニングメモ
## 特徴
- パーミッションドネットワーク（許可制）
    - パーミッションレス（無許可制）ではない
    - 限定的な参加者（金融機関などイメージ)
- ノーブロックチェーン
    - パーミッションドネットワークが前提
    - コンセンサスを取り付けるのにブロックチェーンを取り入れる必要性はない？
- ポイント　ツー　ポイント
    - ブロードキャストではない
    - 公開範囲は限定的
- メッセージキュー
- Law is Law
    - Code is Lawではない
    - 紛争解決は裁判所を頼る（金融機関では必須要件かと）
- UTXOモデル
    - トランザクションをパラレルで走らせることが可能

## イメージ図
#### Cordaネットワーク
![ネットワーク](./assts/corda-network.png)

#### Corda ノード
![ノード](./assts/corda-nodes.png)

## コンポーネント
#### ステート
- 特定時点における合意、契約のようなプライベートに共有したい事実を表現するもの
    - 中央台帳は存在しないため、互いが同じものを見ている必要がある
- デジタル通貨だけでなく、どのようなものも含めることができる
- 不変のオブジェクト
- ステートのライフサイクルはステートシーケンスによって表現される
- Participantsをもつ
    - このステートを消費できる参加者リスト

#### Vault
- ステートシーケンスのHEADを追跡

#### トランザクション
- 台帳を更新するアトミック（分割不可能）な変更のこと
- 0 〜 Nのインプットステートを参照
- 0 〜 Nのアウトプットステートを生成
- 生成されたアウトプットステートはインプットステートを過去のものとしてマークし置き換える
- ステートを分割したり、統合したりする
- 必要なピア全てに署名されて初めてコミットされる（台帳を更新）
- コミットされたトランザクションは不変
- Contract refをもつ
    - 検証が定義されているContractの参照
- トランザクションは「指示」を表すものではなく、更新後の「結果」を表すもの
    - トランザクション作成者が更新後の結果を計算し、アウトプットステートに反映

#### コントラクト
- トランザクションの妥当性を検証し、ステートの遷移をコントロールするもの
- コントラクトコードとLegal Proseの集まり
- コントラクトコード
    - トランザクションを検証する純粋関数
- 法的文書(Legal Prose)
    - 法手続き上、コントラクトコードだけでは不十分な場合に利用
    - 法的文書はハッシュ化して保持（Vaultにて保持）
- トランザクションのステートから参照される

#### アタッチメント
- zipファイルで、ハッシュにより特定
- 種類
    - コントラクトコードと関連するステート定義(.class)
    - 法的文書（テンプレートやパラメータ）
    - コントラクトコードをサポートするデータファイル
        - 例）通貨定義、祝日カレンダーなど
- トランザクションは複数のアタッチメントを含めることが可能
- トランザクション作成者によって追加される

#### コマンド
- 役割
    - コントラクトの検証機能の実行をパラメータ化する
        - 例) 発行と振替で異なる制約を実行する
    - トランザクションへの署名の付与
- ステートを様々な形に変換するもの？
    - トランザクションの提案
    - 決済、支払など

#### タイムウィンドウ
- 一定期間内にトランザクションが発生したことを保証するもの？（よくわかりません。。）

#### フロー
- 共有された事実を合意するために、複雑なステップや、複数ピアとのやりとりを調整する軽量プロセス

#### コンセンサス
- 種類（ピアは、以下の方法で、トランザクションに対し合意する）
    - 検証コンセンサス
    - ユニークネスコンセンサス
- 検証コンセンサス
    - 以下の内容を満たしていることに確証を得られるようにする
        - トランザクションが必要な全ピアにより署名されている
        - コントラクトコードの制約を満たしてる
- ユニークネスコンセンサス
    - トランザクションで作成されたアウトプットステートが、トランザクションにより参照されるインプットステートの後継であることについて確証を持てるようにする

#### ノータリー（公証人）サービス
- ユニークネスコンセンサスを提供する
- 使用済みのステートを追跡する
    - インプットステートの参照をキーとするMapを保存する
    - ステートが消費済みかどうか判断する
    - 例)
        - トランザクションの提案がノータリサービスに送信されたとき、インプットステートの参照が既にMapに存在するかチェックする
        - 存在すれば例外をスロー（コンフリクトが発生していることを伝える）

#### オラクル
- データや計算のソースとなるもの
- トランザクションの提案を検証するのに必要なオフレジャーの事実を認証する（または提供する）権威の役目を果たすもの

#### Cordaノード
- Cordaネットワークの参加に必要な一連のサービスを実装

#### CorDapps
- Cordaノードの拡張機能的なポジション
- ベンダーが実装するところ
- 以下で構成される
    - ステート
    - コントラクト
    - フロー

#### Cordaネットワーク
- 以下で構成される
    - ドアマン
    - ２つ以上のCordaノード
    - 0〜Nのオラクル
    - ネットワークマップサービス
    - 1〜Nのノータリーサービス
        - ノータリーサービスは必須




